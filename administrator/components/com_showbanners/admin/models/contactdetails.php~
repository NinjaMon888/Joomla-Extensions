<?php
// no direct access
defined( '_JEXEC' ) or die( ';)' );

jimport( 'joomla.application.component.model' );
jimport( 'joomla.database.table.user' );

class jticketingModelcontactdetails extends JModel
{
 
    function getData()
    {
     
		$id = JRequest::getVar('cid');
		$db =& JFactory::getDBO();
		$query='SELECT cnt.vs_id,cnt.vs_searchable,cnt.vs_published,cnt.vs_name,cnt.shortcode,item.* FROM #__vs AS cnt  JOIN #__vs_items AS item
			 ON cnt.vs_id = item.vs_id AND item.vs_id='.$id.'';
		$this->_db->setQuery($query);
		$result = $this->_db->loadobjectlist();
	    return $result;
	}
	
	function getInfo()
	{
		$db =& JFactory::getDBO();
		$data 	= JRequest::get( 'post' );
		$query = 'SELECT vs_id FROM #__vs WHERE vs_name ='.$data['seriesname'];
		$db->setQuery( $query );
		$result = $db->loadResult();
	    return $result;
	}
	
	function itemid()
	{
		$db =& JFactory::getDBO();
		$id = JRequest::getVar('cid');
		$query = 'SELECT item_id FROM #__vs_items WHERE vs_id ='.$id;
		$this->_db->setQuery($query);
		$result = $this->_db->loadobjectlist();
		
	    return $result;
	}
	function getvideo()
	{
	    $id = JRequest::getVar('cid');
		$db =& JFactory::getDBO();
		$query='SELECT id, title FROM #__dv_videos ORDER BY title ASC';
		$this->_db->setQuery($query);
		$result = $this->_db->loadobjectlist();
	    return $result;
	
	
	}
	function videoname($id)
	{
	    
		$db =& JFactory::getDBO();
		$query='SELECT id,title FROM #__dv_videos WHERE id='.$id;
		$db->setQuery( $query );
		$result = $db->loadObjectList();
	    
	    return $result;
	}
	
	/* Method to store a client record	 */
	function store()
	{
		$id = JRequest::getVar('cid');
	
		
		$db 	= JFactory::getDBO();			
		$data 	= JRequest::get( 'post' );
		$count	= count($data['longdescription']);
		$user 	= & JFactory::getUser();
		
		$res 	=& $this->getTable('newform');
	    $res->vs_author 	= $user->id; 
	    $res->vs_name   	= $data['seriesname'];
	    $res->shortcode 	= $data['shortcode'];
		$res->vs_searchable = $data['group1'];
		$res->vs_published	= $data['group2'];
		$res->shortcode		= $data['shortcode'];
		$today = date("Y-m-d H:i:s");
		$res->vs_created	= $today;
		$res->vs_modified	= $today;
		if (!$res->store())
		{
			$this->setError( $res->getErrorMsg() );
			return false;
		} 
		
		
		//get the last inserted id
		$id=$this->_db->insertid();
	  
		for($i=0;$i<$count;$i++)
		{
		 $row 	=& $this->getTable('addseries');
		 $row->vs_id=$id;
	     $row->item_ldesc	= $data['longdescription'][$i];
		 $row->item_sdesc = $data['shortdescription'][$i];
		 $row->item_name=$data['blockname'][$i];
		 $row->item_order=$data['position'][$i];
		 $row->item_vlink=$data['linkvideo'][$i];
		 $row->item_vid=$data['_vlink'][$i];
		 
		
		 //$row->item_vlink=$data['linkvideo'][$i];
		
			if (!$row->store()) 
			{
				$this->setError( $row->getErrorMsg() );
				return false;
			} 
		}
		
		
		return true;
	
	}//end store fn
	
	
	function delete($id)
	{
	 $db =& JFactory::getDBO();
	
	 
	 $query = 'DELETE FROM #__vs WHERE vs_id='.$id;
	 $this->_db->setQuery($query);
	 $this->_db->query();
	 
	 $query1 = 'DELETE FROM #__vs_items WHERE vs_id='.$id;
	 $this->_db->setQuery($query1);
	 $this->_db->query();
	 return $true;
	 }
	 function getvidoeseriesItemid1()
	{
		$query = "SELECT id FROM #__menu WHERE link LIKE '%com_videoseries%' AND published =1 ORDER BY ordering";
		$this->_db->setQuery( $query );
		$itemid = $this->_db->loadResult();
		return $itemid;
	}
	 
}

